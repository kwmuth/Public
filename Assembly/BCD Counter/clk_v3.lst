0000              1   ; clk_v3.asm: Displays seconds, minuts, and hours in HEX2 to HEX7
0000              2   ; We can set the time by flipping SW0 and using KEY.3, KEY.2, KEY.1
0000              3   ; to increment the Hours, Minutes, and Seconds.
0000              4   
                 -1   $MODDE2
0000              1   ;  MODDDE2: Register definition for DE2-8052 softcore
0000              2   ;
0000              3   ;   Copyright (C) 2011  Jesus Calvino-Fraga, jesusc at ece.ubc.ca
0000              4   ;
0000              5   ;   This library is free software; you can redistribute it and/or
0000              6   ;   modify it under the terms of the GNU Lesser General Public
0000              7   ;   License as published by the Free Software Foundation; either
0000              8   ;   version 2.1 of the License, or (at your option) any later version.
0000              9   ;
0000             10   ;   This library is distributed in the hope that it will be useful,
0000             11   ;   but WITHOUT ANY WARRANTY; without even the implied warranty of
0000             12   ;   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the GNU
0000             13   ;   Lesser General Public License for more details.
0000             14   ;
0000             15   ;   You should have received a copy of the GNU Lesser General Public
0000             16   ;   License along with this library; if not, write to the Free Software
0000             17   ;   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307 USA
0000             18   ;
0000             19       
0000             20   P0     DATA  080H  ;PORT 0
0000             21   SP     DATA  081H  ;STACK POINTER
0000             22   DPL    DATA  082H  ;DATA POINTER - LOW BYTE
0000             23   DPH    DATA  083H  ;DATA POINTER - HIGH BYTE
0000             24   PCON   DATA  087H  ;POWER CONTROL
0000             25   TCON   DATA  088H  ;TIMER CONTROL
0000             26   TMOD   DATA  089H  ;TIMER MODE
0000             27   TL0    DATA  08AH  ;TIMER 0 - LOW BYTE
0000             28   TL1    DATA  08BH  ;TIMER 1 - LOW BYTE
0000             29   TH0    DATA  08CH  ;TIMER 0 - HIGH BYTE
0000             30   TH1    DATA  08DH  ;TIMER 1 - HIGH BYTE
0000             31   P1     DATA  090H  ;PORT 1
0000             32   SCON   DATA  098H  ;SERIAL PORT CONTROL
0000             33   SBUF   DATA  099H  ;SERIAL PORT BUFFER
0000             34   P2     DATA  0A0H  ;PORT 2
0000             35   IE     DATA  0A8H  ;INTERRUPT ENABLE
0000             36   P3     DATA  0B0H  ;PORT 3
0000             37   IP     DATA  0B8H  ;INTERRUPT PRIORITY
0000             38   T2CON  DATA  0C8H  ;TIMER 2 CONTROL
0000             39   T2MOD  DATA  0C9H  ;TIMER 2 MODE
0000             40   RCAP2L DATA  0CAH  ;TIMER 2 CAPTURE REGISTER - LOW BYTE
0000             41   RCAP2H DATA  0CBH  ;TIMER 2 CAPTURE REGISTER - HIGH BYTE
0000             42   TL2    DATA  0CCH  ;TIMER 2 - LOW BYTE
0000             43   TH2    DATA  0CDH  ;TIMER 2 - HIGH BYTE
0000             44   PSW    DATA  0D0H  ;PROGRAM STATUS WORD
0000             45   ACC    DATA  0E0H  ;ACCUMULATOR
0000             46   B      DATA  0F0H  ;MULTIPLICATION REGISTER
0000             47   IT0    BIT   088H  ;TCON.0 - EXT. INTERRUPT 0 TYPE
0000             48   IE0    BIT   089H  ;TCON.1 - EXT. INTERRUPT 0 EDGE FLAG
0000             49   IT1    BIT   08AH  ;TCON.2 - EXT. INTERRUPT 1 TYPE
0000             50   IE1    BIT   08BH  ;TCON.3 - EXT. INTERRUPT 1 EDGE FLAG
0000             51   TR0    BIT   08CH  ;TCON.4 - TIMER 0 ON/OFF CONTROL
0000             52   TF0    BIT   08DH  ;TCON.5 - TIMER 0 OVERFLOW FLAG
0000             53   TR1    BIT   08EH  ;TCON.6 - TIMER 1 ON/OFF CONTROL
0000             54   TF1    BIT   08FH  ;TCON.7 - TIMER 1 OVERFLOW FLAG
0000             55   RI     BIT   098H  ;SCON.0 - RECEIVE INTERRUPT FLAG
0000             56   TI     BIT   099H  ;SCON.1 - TRANSMIT INTERRUPT FLAG
0000             57   RB8    BIT   09AH  ;SCON.2 - RECEIVE BIT 8
0000             58   TB8    BIT   09BH  ;SCON.3 - TRANSMIT BIT 8
0000             59   REN    BIT   09CH  ;SCON.4 - RECEIVE ENABLE
0000             60   SM2    BIT   09DH  ;SCON.5 - SERIAL MODE CONTROL BIT 2
0000             61   SM1    BIT   09EH  ;SCON.6 - SERIAL MODE CONTROL BIT 1
0000             62   SM0    BIT   09FH  ;SCON.7 - SERIAL MODE CONTROL BIT 0
0000             63   EX0    BIT   0A8H  ;IE.0 - EXTERNAL INTERRUPT 0 ENABLE
0000             64   ET0    BIT   0A9H  ;IE.1 - TIMER 0 INTERRUPT ENABLE
0000             65   EX1    BIT   0AAH  ;IE.2 - EXTERNAL INTERRUPT 1 ENABLE
0000             66   ET1    BIT   0ABH  ;IE.3 - TIMER 1 INTERRUPT ENABLE
0000             67   ES     BIT   0ACH  ;IE.4 - SERIAL PORT INTERRUPT ENABLE
0000             68   ET2    BIT   0ADH  ;IE.5 - TIMER 2 INTERRUPT ENABLE
0000             69   EA     BIT   0AFH  ;IE.7 - GLOBAL INTERRUPT ENABLE
0000             70   RXD    BIT   0B0H  ;P3.0 - SERIAL PORT RECEIVE INPUT
0000             71   TXD    BIT   0B1H  ;P3.1 - SERIAL PORT TRANSMIT OUTPUT
0000             72   INT0   BIT   0B2H  ;P3.2 - EXTERNAL INTERRUPT 0 INPUT
0000             73   INT1   BIT   0B3H  ;P3.3 - EXTERNAL INTERRUPT 1 INPUT
0000             74   T0     BIT   0B4H  ;P3.4 - TIMER 0 COUNT INPUT
0000             75   T1     BIT   0B5H  ;P3.5 - TIMER 1 COUNT INPUT
0000             76   WR     BIT   0B6H  ;P3.6 - WRITE CONTROL FOR EXT. MEMORY
0000             77   RD     BIT   0B7H  ;P3.7 - READ CONTROL FOR EXT. MEMORY
0000             78   PX0    BIT   0B8H  ;IP.0 - EXTERNAL INTERRUPT 0 PRIORITY
0000             79   PT0    BIT   0B9H  ;IP.1 - TIMER 0 PRIORITY
0000             80   PX1    BIT   0BAH  ;IP.2 - EXTERNAL INTERRUPT 1 PRIORITY
0000             81   PT1    BIT   0BBH  ;IP.3 - TIMER 1 PRIORITY
0000             82   PS     BIT   0BCH  ;IP.4 - SERIAL PORT PRIORITY
0000             83   PT2    BIT   0BDH  ;IP.5 - TIMER 2 PRIORITY
0000             84   CAP2   BIT   0C8H  ;T2CON.0 - CAPTURE OR RELOAD SELECT
0000             85   CNT2   BIT   0C9H  ;T2CON.1 - TIMER OR COUNTER SELECT
0000             86   TR2    BIT   0CAH  ;T2CON.2 - TIMER 2 ON/OFF CONTROL
0000             87   EXEN2  BIT   0CBH  ;T2CON.3 - TIMER 2 EXTERNAL ENABLE FLAG
0000             88   TCLK   BIT   0CCH  ;T2CON.4 - TRANSMIT CLOCK SELECT
0000             89   RCLK   BIT   0CDH  ;T2CON.5 - RECEIVE CLOCK SELECTT
0000             90   EXF2   BIT   0CEH  ;T2CON.6 - EXTERNAL TRANSITION FLAG
0000             91   TF2    BIT   0CFH  ;T2CON.7 - TIMER 2 OVERFLOW FLAG
0000             92   P      BIT   0D0H  ;PSW.0 - ACCUMULATOR PARITY FLAG
0000             93   OV     BIT   0D2H  ;PSW.2 - OVERFLOW FLAG
0000             94   RS0    BIT   0D3H  ;PSW.3 - REGISTER BANK SELECT 0
0000             95   RS1    BIT   0D4H  ;PSW.4 - REGISTER BANK SELECT 1
0000             96   F0     BIT   0D5H  ;PSW.5 - FLAG 0
0000             97   AC     BIT   0D6H  ;PSW.6 - AUXILIARY CARRY FLAG
0000             98   CY     BIT   0D7H  ;PSW.7 - CARRY FLAG
0000             99   
0000            100   ; For the altera DE2 configured with an 8051/8052 softcore processor
0000            101   ; we have the following extra registers:
0000            102   
0000            103   HEX0   DATA  091H ; Zero turns the segment on
0000            104   HEX1   DATA  092H ; 
0000            105   HEX2   DATA  093H ; 
0000            106   HEX3   DATA  094H ; 
0000            107   HEX4   DATA  08EH ;
0000            108   HEX5   DATA  08FH ;
0000            109   HEX6   DATA  096H ;
0000            110   HEX7   DATA  097H ;
0000            111   
0000            112   P0MOD  DATA  09AH ; Input/output mode bits for port 0.  '1' sets the port to output mode.
0000            113   P1MOD  DATA  09BH ; Input/output mode bits for port 1
0000            114   P2MOD  DATA  09CH ; Input/output mode bits for port 2
0000            115   P3MOD  DATA  09DH ; Input/output mode bits for port 3
0000            116   
0000            117   LEDRA  DATA  0E8H ; LEDs LEDR0 to LEDR7 (bit addressable, ex: LEDRA.1 for LEDR1)
0000            118   LEDRB  DATA  095H ; LEDs LEDR8 to LEDR15
0000            119   LEDRC  DATA  09EH ; LEDs LEDR16, LEDR15, and LEDG8
0000            120   LEDG   DATA  0F8H ; LEDs LEDG0 to LEDG7 (bit addressable, ex: LEDG.3 for LEDG3)
0000            121   SWA    DATA  0E8H ; Switches SW0 to SW7 (bit addressable, ex: SWA.1 for SW1)
0000            122   SWB    DATA  095H ; Switches SW8 to SW15
0000            123   SWC    DATA  09EH ; Switches SW16 and SW17
0000            124   KEY    DATA  0F8H ; KEY1=KEY.1, KEY2=KEY.2, KEY3=KEY.3.  KEY0 is the reset button! 
0000            125   
0000            126   LCD_CMD   DATA 0D8H ;
0000            127   LCD_DATA  DATA 0D9H ;
0000            128   LCD_MOD   DATA 0DAH ; Write 0xff to make LCD_DATA an output
0000            129   LCD_RW    BIT  0D8H ; '0' writes to LCD
0000            130   LCD_EN    BIT  0D9H ; Toggle from '1' to '0'
0000            131   LCD_RS    BIT  0DAH ; '0' for commands, '1' for data
0000            132   LCD_ON    BIT  0DBH ; Write '1' to power the LCD
0000            133   LCD_BLON  BIT  0DCH ; Write '1' to turn on back light
0000            134   
0000            135   FLASH_CMD  data 0DBH ; The control bits of the flash memory:
0000            136   ; bit 0: FL_RST_N  Set to 1 for normal operation
0000            137   ; bit 1: FL_WE_N
0000            138   ; bit 2: FL_OE_N
0000            139   ; bit 3: FL_CE_N
0000            140   FLASH_DATA data 0DCH ; 8-bit data bus of flash memory.
0000            141   FLASH_MOD  data 0DDH ; 0xff makes FLASH_DATA output.  0x00 makes FLASH_DATA input.
0000            142   FLASH_ADD0 data 0E1H ; address bits 0 to 7.
0000            143   FLASH_ADD1 data 0E2H ; address bits 8 to 15.
0000            144   FLASH_ADD2 data 0E3H ; address bits 16 to 21.
0000            145   
0000              6   
0000              7   org 0000H
0000 02018B       8            ljmp myprogram
0003              9            
000B             10   org 000BH
000B 020019      11            ljmp ISR_timer0
000E             12            
0030             13   DSEG at 30H
0030             14   count10ms: ds 1
0031             15   seconds:   ds 1
0032             16   minutes:   ds 1
0033             17   hours:     ds 1
0034             18   AlarmCount:      ds 3
0037             19   
0000             20   BSEG
0000             21   meridiem:        dbit 1
0001             22   meridiemAlarm: dbit 1
0002             23   
000E             24   CSEG
000E             25   
000E             26   ; Look-up table for 7-segment displays
000E             27   myLUT:
000E C0F9A4B0    28       DB 0C0H, 0F9H, 0A4H, 0B0H, 099H
     99
0013 9282F880    29       DB 092H, 082H, 0F8H, 080H, 090H
     90
0018 FF          30       DB 0FFH ; All segments off
0019             31   
0019             32   XTAL           EQU 33333333
0019             33   FREQ           EQU 100
0019             34   TIMER0_RELOAD  EQU 65538-(XTAL/(12*FREQ))
0019             35   
0019             36   ISR_Timer0:
0019             37            ; Reload the timer
0019 758C93      38       mov TH0, #high(TIMER0_RELOAD)
001C 758A81      39       mov TL0, #low(TIMER0_RELOAD)
001F             40       
001F             41       ; Save used register into the stack
001F C0D0        42       push psw
0021 C0E0        43       push acc
0023 C083        44       push dph
0025 C082        45       push dpl
0027             46       
0027 20E845      47       jb SWA.0, ISR_Timer0_L0 ; Setting up time.  Do not increment anything
002A             48       
002A             49       ; Increment the counter and check if a second has passed
002A 0530        50       inc count10ms
002C E530        51       mov a, count10ms
002E B4643E      52       cjne A, #100, ISR_Timer0_L0
0031 753000      53       mov count10ms, #0
0034             54       
0034             55   
0034             56   
0034             57       
0034 E531        58            mov a, seconds
0036 2401        59       add a, #1
0038 D4          60       da a
0039 F531        61       mov seconds, a
003B B46031      62       cjne A, #60H, ISR_Timer0_L0
003E 753100      63       mov seconds, #0
0041             64   
0041 E532        65       mov a, minutes
0043 2401        66       add a, #1
0045 D4          67       da a
0046 F532        68       mov minutes, a
0048 B46024      69       cjne A, #60H, ISR_Timer0_L0
004B 753200      70       mov minutes, #0
004E             71   
004E E533        72       mov a, hours
0050 2401        73       add a, #1
0052 D4          74       da a
0053 F533        75       mov hours, a
0055 B41211      76       cjne A, #12H, M8
0058             77   CPLMeridiem:
0058 B200        78            cpl meridiem
005A 300003      79            jnb meridiem, AM
005D 200006      80            jb meridiem, PM
0060 759108      81   AM:      mov HEX0, #08H
0063 02006F      82            ljmp ISR_Timer0_L0
0066 75910C      83   PM: mov HEX0, #0CH
0069 B41303      84   M8: cjne A, #13H, ISR_Timer0_L0
006C 753301      85       mov hours, #1
006F             86       
006F             87       
006F             88   ISR_Timer0_L0:
006F 20E944      89            jb SWA.1, do_nothing
0072             90            
0072             91            ; Update the display.  This happens every 10 ms
0072 90000E      92            mov dptr, #myLUT
0075             93   
0075 300003      94            jnb meridiem, InitMeridiemAM
0078 200006      95            jb meridiem, InitMeridiemPM
007B             96   InitMeridiemAM:
007B 759108      97            mov HEX0, #08H
007E 020084      98            ljmp M15
0081             99   InitMeridiemPM:
0081 75910C     100            mov HEX0, #0CH
0084            101   
0084 E531       102   M15:mov a, seconds
0086 540F       103            anl a, #0fH
0088 93         104            movc a, @a+dptr
0089 F593       105            mov HEX2, a
008B E531       106            mov a, seconds
008D C4         107            swap a
008E 540F       108            anl a, #0fH
0090 93         109            movc a, @a+dptr
0091 F594       110            mov HEX3, a
0093            111   
0093 E532       112            mov a, minutes
0095 540F       113            anl a, #0fH
0097 93         114            movc a, @a+dptr
0098 F58E       115            mov HEX4, a
009A E532       116            mov a, minutes
009C C4         117            swap a
009D 540F       118            anl a, #0fH
009F 93         119            movc a, @a+dptr
00A0 F58F       120            mov HEX5, a
00A2            121   
00A2 E533       122            mov a, hours
00A4 540F       123            anl a, #0fH
00A6 93         124            movc a, @a+dptr
00A7 F596       125            mov HEX6, a
00A9 E533       126            mov a, hours
00AB 20E402     127            jb acc.4, ISR_Timer0_L1
00AE 74A0       128            mov a, #0A0H
00B0            129   ISR_Timer0_L1:
00B0 C4         130            swap a
00B1 540F       131            anl a, #0fH
00B3 93         132            movc a, @a+dptr
00B4 F597       133            mov HEX7, a
00B6            134            
00B6            135   ;        cjne A, #12H, do_nothing
00B6            136   ;CPLMeridiem:
00B6            137   ;        cpl meridiem
00B6            138   ;        jnb meridiem, AM
00B6            139   ;        jb meridiem, PM
00B6            140   ;AM:     mov HEX0, #08H
00B6            141   ;        ljmp do_nothing
00B6            142   ;PM: mov HEX0, #0CH
00B6            143   
00B6            144            ; Restore used registers
00B6            145   do_nothing:
00B6 D082       146            pop dpl
00B8 D083       147            pop dph
00BA D0E0       148            pop acc
00BC D0D0       149            pop psw    
00BE 32         150            reti
00BF            151   
00BF            152   Init_Timer0:     
00BF 758901     153            mov TMOD,  #00000001B ; GATE=0, C/T*=0, M1=0, M0=1: 16-bit timer
00C2 C28C       154            clr TR0 ; Disable timer 0
00C4 C28D       155            clr TF0
00C6 758C93     156       mov TH0, #high(TIMER0_RELOAD)
00C9 758A81     157       mov TL0, #low(TIMER0_RELOAD)
00CC D28C       158       setb TR0 ; Enable timer 0
00CE D2A9       159       setb ET0 ; Enable timer 0 interrupt
00D0 22         160       ret
00D1            161   
00D1            162   DisplayAlarmVal:
00D1 90000E     163            mov dptr, #myLUT        
00D4            164   ; Display Digit 1
00D4 E534       165            mov A, AlarmCount+0
00D6 540F       166       anl A, #0FH
00D8 93         167       movc A, @A+dptr
00D9 F593       168       mov HEX2, A   
00DB            169   ; Display Digit 2
00DB E534       170       mov A, AlarmCount+0
00DD C4         171       swap A
00DE 540F       172       anl A, #0FH
00E0 93         173       movc A, @A+dptr
00E1 F594       174       mov HEX3, A   
00E3            175   ; Display digit 3
00E3 E535       176            mov A, AlarmCount+1
00E5 540F       177            anl A, #0FH
00E7 93         178            movc A, @A+dptr
00E8 F58E       179            mov HEX4, A     
00EA            180   ;Display digit 4
00EA E535       181            mov A, AlarmCount+1
00EC C4         182            swap A
00ED 540F       183            anl A, #0FH
00EF 93         184            movc A, @A+dptr
00F0 F58F       185            mov HEX5, A     
00F2            186   ;Display digit 5
00F2 E536       187            mov A, AlarmCount+2
00F4 540F       188            anl A, #0FH
00F6 93         189            movc A, @A+dptr
00F7 F596       190            mov HEX6, A
00F9            191   ;Display digit 6
00F9 E536       192            mov A, AlarmCount+2
00FB C4         193            swap A
00FC 540F       194            anl A, #0FH
00FE 93         195            movc A, @A+dptr
00FF F597       196            mov HEX7, A
0101 020104     197            ljmp SetAlarm
0104            198   
0104            199   SetAlarm:
0104 20F917     200            jb KEY.1, M6
0107 D2FA       201            setb LEDG.2
0109 30F9FD     202            jnb KEY.1, $
010C E534       203            mov a, AlarmCount+0
010E 2401       204       add a, #1
0110 D4         205       da a
0111 F534       206       mov AlarmCount+0, a
0113 B460BB     207       cjne A, #60H, DisplayAlarmVal
0116 753400     208       mov AlarmCount+0, #0
0119 C2FA       209       clr LEDG.2
011B 0200D1     210       ljmp DisplayAlarmVal
011E 20FA13     211   M6:      jb KEY.2, M7
0121 30FAFD     212       jnb KEY.2, $
0124 E535       213       mov a, AlarmCount+1
0126 2401       214            add a, #1
0128 D4         215            da a
0129 F535       216            mov AlarmCount+1, a
012B B460A3     217       cjne A, #60H, DisplayAlarmVal
012E 753500     218       mov AlarmCount+1, #0
0131 0200D1     219       ljmp DisplayAlarmVal
0134 20FB16     220   M7: jb KEY.3, M9
0137 30FBFD     221            jnb KEY.3, $
013A E536       222            mov a, AlarmCount+2
013C 2401       223            add a, #1
013E D4         224            da a
013F F536       225            mov AlarmCount+2, a
0141 120153     226            lcall AlarmAMPM
0144 B4138A     227       cjne A, #13H, DisplayAlarmVal
0147 753601     228       mov AlarmCount+2, #1H
014A 0200D1     229       ljmp DisplayAlarmVal
014D 20E9B4     230   M9:      jb SWA.1, SetAlarm
0150 0201BB     231            ljmp M4
0153            232            
0153            233   AlarmAMPM:
0153 E536       234            mov a, AlarmCount+2
0155 B41210     235            cjne a, #12H, returnAlarm
0158 B201       236            cpl meridiemAlarm
015A 300103     237            jnb meridiemAlarm, ChangeToAMAlarm
015D 200105     238            jb meridiemAlarm, ChangeToPMAlarm
0160            239   ChangeToAMAlarm:
0160 759108     240            mov HEX0, #08H
0163 8019       241            sjmp return
0165            242   ChangeToPMAlarm:
0165 75910C     243            mov HEX0, #0CH
0168            244   returnAlarm:
0168 22         245            ret
0169            246   
0169            247   AMPM:
0169 E533       248            mov a, hours
016B B41210     249            cjne a, #12H, return
016E B200       250            cpl meridiem
0170 300003     251            jnb meridiem, ChangeToAM
0173 200005     252            jb meridiem, ChangeToPM
0176            253   ChangeToAM:
0176 759108     254            mov HEX0, #08H
0179 8003       255            sjmp return
017B            256   ChangeToPM:
017B 75910C     257            mov HEX0, #0CH
017E            258   return:
017E 22         259            ret
017F            260   
017F            261   SetAlarm1:
017F 753400     262            mov AlarmCount+0, #00H
0182 753500     263            mov AlarmCount+1, #00H
0185 753612     264            mov AlarmCount+2, #12H
0188 020104     265            ljmp SetAlarm
018B            266            
018B            267   myprogram:
018B 75817F     268            mov SP, #7FH
018E 75E800     269            mov LEDRA,#0
0191 759500     270            mov LEDRB,#0
0194 759E00     271            mov LEDRC,#0
0197 75F800     272            mov LEDG,#0
019A            273            
019A 753100     274            mov seconds, #00H
019D 753200     275            mov minutes, #00H
01A0 753312     276            mov hours, #12H
01A3            277            
01A3 753400     278            mov AlarmCount+0, #00H
01A6 753500     279            mov AlarmCount+1, #00H
01A9 753612     280            mov AlarmCount+2, #12H
01AC            281            
01AC C200       282            clr meridiem
01AE C201       283            clr meridiemAlarm
01B0 759108     284            mov HEX0, #08H
01B3            285   
01B3 1200BF     286            lcall Init_Timer0
01B6 D2AF       287       setb EA  ; Enable all interrupts
01B8            288   
01B8            289   M0:
01B8 20E9C4     290            jb SWA.1, SetAlarm1
01BB 30E8FA     291   M4:      jnb SWA.0, M0
01BE 20FB13     292            jb KEY.3, M1
01C1 30FBFD     293       jnb KEY.3, $
01C4 E533       294       mov a, hours
01C6 2401       295            add a, #1
01C8 D4         296            da a
01C9 F533       297            mov hours, a
01CB 120169     298            lcall AMPM
01CE B41303     299       cjne A, #13H, M1
01D1 753301     300       mov hours, #1
01D4            301   
01D4            302   M1:      
01D4 20FA10     303            jb KEY.2, M2
01D7 30FAFD     304       jnb KEY.2, $
01DA E532       305       mov a, minutes
01DC 2401       306            add a, #1
01DE D4         307            da a
01DF F532       308            mov minutes, a
01E1 B46003     309       cjne A, #60H, M2
01E4 753201     310       mov minutes, #1
01E7            311   
01E7            312   M2:      
01E7 20F910     313            jb KEY.1, M3
01EA 30F9FD     314            jnb KEY.1, $
01ED E531       315            mov a, seconds
01EF 2401       316            add a, #1
01F1 D4         317            da a
01F2 F531       318            mov seconds, a
01F4 B46003     319       cjne A, #60H, M3
01F7 753101     320       mov seconds, #1
01FA            321   
01FA            322   M3:      
01FA 0201B8     323            ljmp M0
01FD            324   END
